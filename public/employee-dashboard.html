<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vouched | Employee Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        obsidian: '#050505',
                        surface: '#0a0a0a',
                        neon: '#00f0ff',
                        'neon-green': '#00ff88',
                        'neon-purple': '#a855f7',
                        'neon-pink': '#ff0080'
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        .cosmic-bg {
            background: radial-gradient(ellipse at 20% 20%, rgba(0, 240, 255, 0.06) 0%, transparent 50%),
                        radial-gradient(ellipse at 80% 80%, rgba(168, 85, 247, 0.06) 0%, transparent 50%),
                        #050505;
        }
        
        .neural-grid {
            background-image: 
                linear-gradient(rgba(0, 240, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            animation: gridPulse 8s ease-in-out infinite;
        }
        @keyframes gridPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }
        
        .glass { 
            backdrop-filter: blur(20px); 
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
            background: linear-gradient(135deg, #00f0ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .live-dot {
            animation: livePulse 2s ease-in-out infinite;
        }
        @keyframes livePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            50% { box-shadow: 0 0 0 8px rgba(0, 255, 136, 0); }
        }
        
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            border-color: rgba(0, 240, 255, 0.3);
            transform: translateY(-2px);
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #00f0ff, #a855f7); border-radius: 3px; }
    </style>
</head>
<body class="cosmic-bg text-white min-h-screen">
    
    <!-- Background -->
    <div class="fixed inset-0 neural-grid pointer-events-none z-0"></div>

    <!-- Header -->
    <header class="glass sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <a href="index.html" class="flex items-center gap-1 group">
                    <span class="font-black text-xl tracking-wider text-white group-hover:text-red-500 transition" style="font-family: 'Orbitron', sans-serif;">V</span>
                    <svg class="w-5 h-5 text-red-500" viewBox="0 0 100 100" fill="currentColor"><path d="M50 5 C50 5 60 25 75 30 C75 30 60 35 55 50 C55 50 65 45 80 50 C80 50 60 55 55 70 C55 70 60 65 75 70 C75 70 55 80 50 95 C45 80 25 70 25 70 C40 65 45 70 45 70 C40 55 20 50 20 50 C35 45 45 50 45 50 C40 35 25 30 25 30 C40 25 50 5 50 5Z"/></svg>
                    <span class="font-black text-xl tracking-wider text-white group-hover:text-red-500 transition" style="font-family: 'Orbitron', sans-serif;">UCHED</span>
                </a>
                <span class="text-white/20">|</span>
                <span class="text-gray-400 text-sm">Employee Dashboard</span>
                <div class="hidden md:flex items-center gap-2 px-3 py-1 bg-blue-500/20 border border-blue-500/30 rounded-full">
                    <div class="w-1.5 h-1.5 bg-blue-400 rounded-full"></div>
                    <span class="text-[9px] font-bold text-blue-400 uppercase tracking-wider">Read Only</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <a href="traditions-bulk.html" class="text-neon hover:text-neon-green text-sm font-medium transition">View Marketplace</a>
                <button id="signOutBtn" class="text-gray-400 hover:text-red-400 text-sm font-medium transition">Sign Out</button>
            </div>
        </div>
    </header>

    <div class="max-w-6xl mx-auto px-6 py-8 relative z-10">
        <!-- User Info Card -->
        <div class="glass rounded-2xl p-6 mb-8">
            <div class="flex flex-col md:flex-row justify-between gap-4">
                <div>
                    <p class="text-gray-500 text-xs uppercase tracking-wider mb-1">Welcome</p>
                    <h2 id="userNameDisplay" class="text-2xl font-bold text-white mb-4">Loading...</h2>
                    <div class="flex gap-6 text-sm">
                        <div>
                            <p class="text-gray-500 text-xs uppercase tracking-wider mb-1">Company</p>
                            <p id="userCompanyDisplay" class="stat-value font-bold">---</p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs uppercase tracking-wider mb-1">License</p>
                            <p id="userLicenseDisplay" class="stat-value font-bold">---</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-start gap-2 px-4 py-2 bg-blue-500/10 border border-blue-500/30 rounded-xl">
                    <svg class="w-5 h-5 text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    <div>
                        <p class="text-blue-400 font-bold text-sm">View Only Access</p>
                        <p class="text-blue-400/60 text-xs">You can view inventory but cannot make changes</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="glass rounded-xl p-5 text-center">
                <p class="text-3xl font-black stat-value" id="totalProducts">0</p>
                <p class="text-gray-500 text-xs uppercase tracking-wider mt-1">Products</p>
            </div>
            <div class="glass rounded-xl p-5 text-center">
                <p class="text-3xl font-black stat-value" id="totalValue">$0</p>
                <p class="text-gray-500 text-xs uppercase tracking-wider mt-1">Total Value</p>
            </div>
            <div class="glass rounded-xl p-5 text-center">
                <p class="text-3xl font-black stat-value" id="publicCount">0</p>
                <p class="text-gray-500 text-xs uppercase tracking-wider mt-1">Public</p>
            </div>
            <div class="glass rounded-xl p-5 text-center">
                <p class="text-3xl font-black stat-value" id="privateCount">0</p>
                <p class="text-gray-500 text-xs uppercase tracking-wider mt-1">Private</p>
            </div>
        </div>

        <!-- Inventory Section -->
        <div class="glass rounded-2xl p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-white flex items-center gap-3">
                    <span class="w-3 h-3 bg-neon rounded-full live-dot"></span>
                    Company Inventory
                </h2>
                <div class="flex items-center gap-2 text-xs text-gray-500">
                    <div class="w-1.5 h-1.5 bg-neon-green rounded-full live-dot"></div>
                    Live Updates
                </div>
            </div>

            <div id="inventoryList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                <p class="text-gray-500 col-span-full text-center py-8">Loading inventory...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { auth, db } from './js/firebase-init.js';
        import { onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
        import { collection, query, where, onSnapshot, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

        let currentUser = null;

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'login.html';
                return;
            }

            const userDocSnap = await getDoc(doc(db, 'users', user.uid));
210            const userData = userDocSnap.exists() ? userDocSnap.data() : null;
            
            // Allow admin or employee access
            if (!userData || (!userData.approved && userData.role !== 'admin')) {
                alert('Access denied or account not approved');
                await signOut(auth);
                window.location.href = 'login.html';
                return;
            }

            currentUser = user;
            
            document.getElementById('userNameDisplay').textContent = `${userData.firstName || ''} ${userData.lastName || ''}`.trim() || 'User';
            document.getElementById('userCompanyDisplay').textContent = userData.companyName || 'Company';
            document.getElementById('userLicenseDisplay').textContent = userData.licenseNumber || 'N/A';

            // Load inventory based on vendor ID (linked to their company)
            const inventoryQuery = query(
                collection(db, 'inventory'),
                where('vendorId', '==', userData.linkedVendorId || user.uid)
            );
            
            onSnapshot(inventoryQuery, (snapshot) => {
                const products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderInventory(products);
                updateStats(products);
            });
        });

        function updateStats(products) {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('totalValue').textContent = '$' + products.reduce((sum, p) => sum + (p.price || 0), 0).toLocaleString();
            document.getElementById('publicCount').textContent = products.filter(p => p.isPublic !== false).length;
            document.getElementById('privateCount').textContent = products.filter(p => p.isPublic === false).length;
        }

        function renderInventory(products) {
            const container = document.getElementById('inventoryList');
            if (products.length === 0) {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center py-8">No products in inventory</p>';
                return;
            }

            container.innerHTML = products.map(p => `
                <div class="product-card glass rounded-xl overflow-hidden">
                    <div class="h-28 bg-surface relative">
                        ${p.imageUrl ? `<img src="${p.imageUrl}" class="w-full h-full object-cover">` : '<div class="w-full h-full flex items-center justify-center text-gray-600">No Image</div>'}
                        <div class="absolute top-2 right-2">
                            <span class="px-2 py-1 text-[10px] font-bold rounded ${p.isPublic !== false ? 'bg-neon-green/20 text-neon-green' : 'bg-red-500/20 text-red-400'}">
                                ${p.isPublic !== false ? 'PUBLIC' : 'PRIVATE'}
                            </span>
                        </div>
                    </div>
                    <div class="p-4">
                        <h4 class="font-bold text-white mb-1 truncate">${p.name}</h4>
                        <p class="text-xl font-black stat-value">$${p.price}<span class="text-xs text-gray-500 font-normal">/${p.unit || 'unit'}</span></p>
                        <p class="text-xs text-gray-500 mt-2">${p.category || 'Uncategorized'}</p>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('signOutBtn').addEventListener('click', () => signOut(auth));
    </script>
</body>
</html>
